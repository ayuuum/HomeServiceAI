# 製品要求仕様書 (PRD)

## 1. プロジェクト概要
**プロジェクト名**: Haukuri Pro (ハウクリPro)

**タグライン**: 
> 電話もLINEもAIが24時間受付。1件も取りこぼさない。口コミも自動で増える。だから売上が上がる。

**目的**: ハウスクリーニング事業者向けAI受付・予約自動化プラットフォーム。電話・LINEに24時間応答し、予約確定・リマインド・口コミ回収まで自動化することで、取りこぼしゼロと売上最大化を実現する。

**差別化**: 
- 競合（STORES予約、くらしのマーケット、Airリザーブ）= 予約管理SaaS
- Haukuri Pro = **AIが顧客接点を自動化** → 予約は結果として発生


## 2. ターゲットユーザー (ユーザーペルソナ)

| ロール | 説明 | 主なユースケース |
| :--- | :--- | :--- |
| **管理者 (Admin)** | システム全体の管理権限を持つユーザー（本部・店舗オーナー）。 | 売上確認、全予約の管理、スタッフ管理、サービスメニュー編集、設定変更。 |
| **スタッフ (Staff)** | 現場でサービスを提供する担当者。 | 自身のスケジュール確認、予約詳細の確認、作業完了報告。 |
| **顧客 (Customer)** | サービスを利用する一般ユーザー。 | サービスの検索・予約、予約履歴の確認、プロフィール管理、ログイン（LINE/Google含む）。 |

## 3. 機能要件

### 3.1 認証・ユーザー管理
*   **サインアップ/ログイン**: メールアドレス・パスワードによる登録・認証。
*   **ソーシャルログイン**: GoogleアカウントおよびLINEアカウントを使用したワンクリックログイン。
*   **パスワードリセット**: パスワードを忘れた場合の再設定フロー。
*   **プロフィール管理**: ユーザー情報の閲覧・編集 (名前、連絡先など)。

### 3.2 予約管理 (Booking Management)
*   **カレンダー表示**: 月/週/日単位での予約状況の可視化。ドラッグ＆ドロップでの直感的な操作（管理者向け）。
*   **予約リスト**: 全予約の一覧表示、ステータス（未確定、確定、完了、キャンセルなど）によるフィルタリング。
*   **新規予約作成**: 管理画面からの代理予約登録、および顧客用の予約フォーム（日時選択、メニュー選択）。
*   **予約詳細**: 顧客情報、サービス内容、金額、担当スタッフ等の詳細確認。
*   **セルフキャンセル**: 顧客による予約キャンセル機能。
*   **セルフ日程変更**: 顧客による予約日時変更機能。
*   **作業完了報告**: スタッフによる作業完了登録。
*   **営業時間設定**: 組織別の営業時間管理。

### 3.3 顧客管理 (CRM)
*   **顧客一覧**: 登録顧客の検索・一覧表示。
*   **顧客詳細**: 顧客ごとの基本情報、過去の利用履歴、メモ（特記事項）の管理。

### 3.4 サービス・メニュー管理
*   **サービス一覧**: 提供サービスの登録・編集・削除。
*   **カテゴリ設定**: サービスをカテゴライズして管理（例: エアコン、キッチン、水回り）。
*   **価格・所要時間設定**: サービスごとの基本料金と標準作業時間の設定。

### 3.5 レポート・分析 (Reports)
*   **ダッシュボード**: 売上推移、予約件数、稼働率などの主要KPIをグラフで可視化。
*   **実績集計**: 期間指定による売上・稼働実績の集計。

### 3.6 決済機能 (Stripe連携)
*   **オンライン決済**: Stripe Checkoutによる事前決済対応。
*   **Stripe Connect**: 事業者向けの決済アカウント連携（OAuth認証）。
*   **返金処理**: 管理画面からの返金実行機能。
*   **Webhook連携**: 決済完了・失敗イベントの自動処理。
*   **月次請求レポート**: 月次の請求・売上集計機能。

### 3.7 LINE連携
*   **LIFF予約**: LINE内ブラウザでシームレスな予約フロー。
*   **LINEログイン**: LINE OAuthによるワンタップ認証。
*   **双方向メッセージ**: 管理画面からの顧客チャット機能。
*   **一斉配信**: セグメント別メッセージ配信（ブロードキャスト）。
*   **予約通知**: 確認・リマインダーの自動送信。
*   **LINE AIエージェント**: 自然言語での予約受付対応。

### 3.8 通知システム
*   **ハイブリッド通知**: LINE/メールの自動切り替え（LINE未連携時はメール）。
*   **自動リマインダー**: Cronジョブによる予約前日リマインド。
*   **メール通知**: 予約確認・変更・キャンセル通知メール。

### 3.9 AIアシスタント
*   **管理者AIアシスタント**: 予約状況・売上分析の質問応答。
*   **予約AIアシスタント**: 顧客向け予約支援チャットボット。

### 3.10 AI受付（Voice Agent）⭐ コア機能
*   **AI電話受付**: Vapi/Twilio + OpenAI による24時間自動応答。
*   **インテント判定**: 新規予約・変更・問い合わせの自動分類。
*   **ヒアリング**: 顧客情報・希望日時の対話的収集。
*   **空き枠確認**: リアルタイムカレンダー連携。
*   **予約確定**: AIによる自動予約完了。
*   **通知連携**: SMS/LINE通知 + CRM自動記録。
*   **AIカスタマイズ**: 自然言語でのAIトレーニング（60秒コーチング）。

**ワークフロー**:
```
着信 → AI即時応答 → インテント判定 → ヒアリング → 空き枠確認 → 予約確定 → SMS/LINE通知 → CRM記録
```

### 3.11 ポストサービス自動化
*   **お礼メッセージ**: 施工完了後の自動お礼LINE/メール。
*   **口コミ依頼**: Googleレビューリンク付き自動依頼。
*   **リマインド**: 3ヶ月後の定期クリーニング提案。
*   **再予約促進**: リピート予約の自動案内。

**ワークフロー**:
```
施工完了 → お礼LINE → 口コミ依頼(数時間後) → 3ヶ月後リマインド → 再予約促進
```

## 4. 非機能要件

### 4.1 パフォーマンス
*   SPA (Single Page Application) アーキテクチャにより、高速な画面遷移を実現。
*   データベースクエリの最適化と適切なインデックス設計によるレスポンス維持。

### 4.2 セキュリティ
*   **RLS (Row Level Security)**: Supabaseの行レベルセキュリティを使用し、データアクセスを厳格に制御（例: 顧客は自分のデータのみ参照可能）。
*   **認証**: 堅牢な認証基盤 (Supabase Auth) の利用。

### 4.3 UI/UX
*   **レスポンシブデザイン**: PC、タブレット、スマートフォンなどあらゆるデバイスで最適に表示。
*   **モダンなUI**: Shadcn UIを採用し、直感的で洗練されたインターフェースを提供。

### 4.4 可用性・スケーラビリティ
*   **SLA目標**: 99.9%の稼働率を目標とする。
*   **スケーラビリティ**: サーバーレスアーキテクチャにより、負荷に応じた自動スケーリング。
*   **想定規模**: 同時接続100ユーザー、月間予約1,000件以上に対応。

### 4.5 監視・ログ
*   **エラー監視**: Supabase Dashboard・Vercel Logsによるエラー追跡。
*   **ログ管理**: Edge Functions実行ログ、認証ログの保持。
*   **アラート**: 決済失敗・システムエラー時のメール通知。

## 5. 技術スタック
*   **Frontend**: React, TypeScript, Vite, Tailwind CSS, Shadcn UI
*   **Backend**: Supabase (PostgreSQL, Auth, Edge Functions, Storage, Realtime)
*   **State Management**: TanStack Query, React Context
*   **Payment**: Stripe (Checkout, Connect, Webhooks)
*   **Messaging**: LINE Messaging API, LIFF SDK
*   **AI**: OpenAI API (GPT-4)
*   **Infrastructure**: Vercel (Frontend Hosting), Supabase (Backend Hosting)

## 6. ドキュメント体系
*   `docs/architecture.md`: アーキテクチャ詳細
*   `docs/deployment.md`: デプロイ手順
*   `docs/line_integration_guide.md`: LINE連携ガイド
*   `docs/stripe_integration_guide.md`: Stripe決済連携ガイド
*   `docs/ai_assistant_guide.md`: AIアシスタント実装ガイド
*   `docs/ai_voice_agent_research.md`: AI電話受付技術調査（Vapi/Twilio比較）

## 7. 成功指標 (KPI)

### プロダクトKPI
| 指標 | 目標値 | 計測方法 |
|------|--------|----------|
| 月間予約件数 | 1,000件+ | ダッシュボード集計 |
| 予約完了率 | 90%以上 | 確定/総予約 |
| オンライン決済利用率 | 70%以上 | Stripe決済/総決済 |
| LINE連携率 | 50%以上 | LINE登録顧客/総顧客 |

### 事業KPI ⭐
| 指標 | 目標値 | 計測方法 |
|------|--------|----------|
| 取りこぼし回収 | 月10件 | AI→予約転換 |
| AI予約率 | 70% | AI完了/総予約 |
| 応答時間 | <30秒 | 着信→AI応答 |
| 売上改善 | +20% | 導入前後比較 |
| 口コミ獲得 | 月5件 | Google投稿数 |
| チャーン率 | <5% | 月次解約率 |

## 8. ロードマップ

| Phase | 時期 | 内容 | 目的 |
|-------|------|------|------|
| v0.5 | 〜2月末 | AI電話MVP + 基本予約 | 売上回復検証 |
| v1.0 | 3月 | LINE統合 + 自動予約確定 | 2チャネル統合 |
| v1.1 | 4–5月 | 口コミ自動化 + AIカスタマイズ | SEOループ |
| v1.5 | 6–7月 | Stripe決済 | 有料化対応 |
| v2.0 | Q4 | マルチテナント + 配車最適化 | スケール |

## 9. リリース履歴

| バージョン | リリース日 | 主な変更 |
|------------|------------|----------|
| v1.0.0 | 2026-01-15 | 初回リリース（基本機能） |
| v1.1.0 | 2026-02-01 | Stripe Connect対応、LINE LIFF |
| v1.2.0 | 2026-02-07 | AIアシスタント、ハイブリッド通知 |
