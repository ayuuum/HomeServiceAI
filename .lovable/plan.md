

# 「〇〇で簡単予約」テキストの編集機能

## 現状

### プレビュー表示（ProfilePage.tsx:860-865）
```typescript
<p className="text-lg font-bold" style={{ color: brandColor }}>
  {organization?.name || '店舗名'}で簡単予約
</p>
```

### データベース（organizations テーブル）
現在ブランディング関連カラム:
- `logo_url` - ロゴ画像URL
- `brand_color` - ブランドカラー
- `welcome_message` - ウェルカムメッセージ
- `header_layout` - ヘッダーレイアウト

**「〇〇で簡単予約」部分を編集するカラムが存在しない**

---

## 実装内容

### 1. データベースマイグレーション

`organizations` テーブルに新しいカラムを追加：

| カラム名 | 型 | デフォルト値 | 説明 |
|---------|-----|-------------|------|
| `booking_headline` | text | NULL | 予約ページの見出しテキスト |

デフォルト動作：NULLの場合は従来通り「{店舗名}で簡単予約」を表示

### 2. 管理画面の更新（ProfilePage.tsx）

ウェルカムメッセージの上に入力フィールドを追加：

```text
┌─────────────────────────────────────┐
│ 見出しテキスト                        │
│ ┌─────────────────────────────────┐ │
│ │ ○○で簡単予約                    │ │
│ └─────────────────────────────────┘ │
│ 空欄の場合「{店舗名}で簡単予約」が表示 │
└─────────────────────────────────────┘
```

### 3. プレビュー表示の更新

```typescript
// 変更前
{organization?.name || '店舗名'}で簡単予約

// 変更後
{bookingHeadline || `${organization?.name || '店舗名'}で簡単予約`}
```

### 4. 予約ページへの反映（BookingPage.tsx）

`get_organization_public` RPCで取得するデータに `booking_headline` を含め、予約ページのヘッダー部分にも反映（現在は予約ページにこの見出しは表示されていないが、必要に応じて追加）

### 5. 保存処理の更新

`handleBrandingUpdate` 関数で `booking_headline` も保存対象に追加

---

## 変更ファイル一覧

| ファイル | 変更内容 |
|----------|----------|
| マイグレーションSQL | `booking_headline` カラム追加 |
| `src/pages/ProfilePage.tsx` | 入力フィールド追加、state管理、保存処理更新 |
| `src/integrations/supabase/types.ts` | 型定義の自動更新 |

---

## 技術詳細

### RPC関数の確認

`get_organization_public` がパブリックデータを返すため、新カラムも含めるか確認が必要。ブランディング情報は公開しても問題ないため、SELECTに追加。

### UIフロー

```text
管理者がプロフィールページを開く
         │
         ▼
「ブランディング設定」セクション
         │
         ├── ロゴアップロード
         ├── ブランドカラー選択
         ├── ヘッダーレイアウト選択
         ├── 【新規】見出しテキスト入力  ←追加
         ├── ウェルカムメッセージ
         └── プレビュー表示
         │
         ▼
「保存」ボタンでDBに反映
```

---

## 期待される結果

1. 管理者が「〇〇で簡単予約」の部分を自由に編集可能
2. 空欄の場合は従来通り「{店舗名}で簡単予約」が表示される
3. プレビューでリアルタイムに確認可能
4. 設定は予約ページにも反映される

