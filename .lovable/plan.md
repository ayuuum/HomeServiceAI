

# サービスアップセル機能の実装プラン

## 概要

予約確認画面（Step 4）で、選択済みサービスに関連する「まだ選んでいないオプション」を「おすすめ」として提案し、ワンタップで追加できる機能を実装します。

---

## UIイメージ

確認画面の「選択サービス」セクションと「合計金額」セクションの間に挿入：

```text
┌─────────────────────────────────────────┐
│ ✨ よく一緒に選ばれているオプション       │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 防カビコート          ¥2,200       │ │
│ │ 80%のお客様が追加しています        │ │
│ │                        [+ 追加]    │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ドレンホース洗浄      ¥1,500       │ │
│ │ 専門家がおすすめ                    │ │
│ │                        [+ 追加]    │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

## 実装内容

### 1. 新規コンポーネント: `BookingUpsellSection.tsx`

選択済みサービスに紐づくオプションのうち、まだ選択されていないものを抽出して提案カードとして表示します。

- 選択済みオプションは自動的に除外
- 追加ボタンを押すと既存の `handleOptionChange` が呼ばれ、即座に合計金額に反映
- 追加後はそのカードがフェードアウト

### 2. `BookingPage.tsx` の変更

Step 4の「お客様情報」セクションと「合計金額」セクションの間に `BookingUpsellSection` を挿入。

```text
Step 4 の構成:
├── 選択サービスまとめ
├── 希望日時まとめ
├── お客様情報まとめ
├── ★ アップセルセクション（新規追加）
└── 合計金額
```

### 3. ロジック

データベースの変更は不要です。既存の `allOptions`（選択サービスに紐づく全オプション）と `selectedOptions` を比較して未選択オプションをフィルタリングするだけで実現できます。

```text
提案対象 = allOptions - selectedOptions
```

---

## 技術的な変更

| ファイル | 変更内容 |
|----------|---------|
| `src/components/booking/BookingUpsellSection.tsx` | 新規作成 - アップセルUI |
| `src/pages/BookingPage.tsx` | Step 4にコンポーネントを挿入 |

### BookingUpsellSection のプロップス

- `allOptions`: 選択サービスに関連する全オプション
- `selectedOptionIds`: 既に選択済みのオプションIDセット
- `onAddOption`: オプション追加コールバック（既存の handleOptionChange を再利用）

### 表示条件

- 未選択のオプションが1つ以上ある場合のみ表示
- 全オプション選択済みなら非表示

