
# データエクスポート機能

## 概要

管理画面から予約データ・顧客データ・売上レポートをCSV形式でエクスポートできる機能を実装します。管理者が会計処理や分析、バックアップ目的で利用できます。

---

## エクスポート対象データ

| データ種別 | 配置画面 | 含まれる情報 |
|-----------|---------|-------------|
| 予約データ | ダッシュボード / カレンダー | 予約日時、顧客名、サービス、金額、ステータス |
| 顧客データ | 顧客管理 | 顧客名、電話、メール、住所、利用回数、利用総額 |
| 売上レポート | 経営管理 | 日別売上、サービス別予約数 |

---

## 実装内容

### 1. CSVエクスポート用ユーティリティ作成

**ファイル:** `src/lib/exportUtils.ts`

CSVファイル生成とダウンロードを行う共通関数を作成します。

```text
機能:
- オブジェクト配列をCSV文字列に変換
- 日本語文字化け対策（BOM付きUTF-8）
- 日付フォーマット統一
- ブラウザでのファイルダウンロード
```

### 2. 顧客管理画面にエクスポートボタン追加

**ファイル:** `src/pages/CustomerManagement.tsx`

顧客一覧の上部にCSVエクスポートボタンを追加します。

エクスポート項目:
- 顧客名
- 電話番号
- メールアドレス
- 郵便番号
- 住所
- 建物名
- 利用回数
- 利用総額
- 登録日

### 3. ダッシュボードに予約データエクスポート追加

**ファイル:** `src/pages/AdminDashboard.tsx`

予約一覧の上部にCSVエクスポートボタンを追加します。

エクスポート項目:
- 予約ID
- 予約日
- 時間
- 顧客名
- 電話番号
- メールアドレス
- サービス名
- 数量
- 合計金額
- ステータス
- 作成日

### 4. 経営管理画面にレポートエクスポート追加

**ファイル:** `src/pages/ReportsPage.tsx`

売上データのCSVエクスポートボタンを追加します。

エクスポート項目:
- 日付
- 売上金額

---

## UI設計

各画面に追加するエクスポートボタンのデザイン:

```text
+-------------------------------------------+
|  [検索フィールド]  [新規登録] [CSVエクスポート ↓]  |
+-------------------------------------------+
```

- アイコン: download または file_download
- ボタンスタイル: outline variant
- クリック時: 即座にCSVファイルがダウンロード開始

### エクスポートファイル名

```text
- 顧客データ: customers_YYYY-MM-DD.csv
- 予約データ: bookings_YYYY-MM-DD.csv  
- 売上レポート: sales_report_YYYY-MM-DD.csv
```

---

## 変更ファイル一覧

| ファイル | 変更内容 |
|---------|---------|
| `src/lib/exportUtils.ts` | 新規作成 - CSVエクスポート用ユーティリティ |
| `src/pages/CustomerManagement.tsx` | エクスポートボタン追加 |
| `src/pages/AdminDashboard.tsx` | 予約データエクスポートボタン追加 |
| `src/pages/ReportsPage.tsx` | 売上レポートエクスポートボタン追加 |

---

## 技術詳細

### CSVエクスポートユーティリティ

```text
exportUtils.ts の主要関数:

1. convertToCSV(data: object[], columns: ColumnConfig[])
   - カラム設定に基づいてCSV文字列を生成
   - ヘッダー行（日本語）+ データ行

2. downloadCSV(csvContent: string, filename: string)
   - BOM付きUTF-8でBlobを作成
   - 自動的にダウンロードトリガー

3. formatDate(date: string | Date)
   - 日付を YYYY/MM/DD 形式に統一

4. formatCurrency(amount: number)
   - 金額を数値のみで出力（Excelで計算可能に）
```

### カラム設定例

```text
顧客データ:
[
  { key: 'name', header: '顧客名' },
  { key: 'phone', header: '電話番号' },
  { key: 'email', header: 'メールアドレス' },
  { key: 'postalCode', header: '郵便番号' },
  { key: 'address', header: '住所' },
  { key: 'addressBuilding', header: '建物名' },
  { key: 'bookingCount', header: '利用回数' },
  { key: 'totalSpend', header: '利用総額' }
]
```

---

## 実装後の動作フロー

```text
[管理者] エクスポートボタンをクリック
         ↓
[システム] 現在表示中のデータを取得
         ↓
[システム] CSVフォーマットに変換（BOM付きUTF-8）
         ↓
[ブラウザ] ファイルをダウンロード
         ↓
[管理者] Excelで開いて確認・分析
```

---

## 考慮事項

### 文字化け対策
- UTF-8 BOM（\uFEFF）を先頭に付加
- Excelで直接開いても日本語が正しく表示される

### フィルター適用
- 検索・フィルター適用中は、フィルター結果のみをエクスポート
- 全データをエクスポートしたい場合は、フィルターをクリアしてから実行

### パフォーマンス
- クライアントサイドで処理（大量データでも問題なし）
- 1000件程度であれば瞬時に完了
