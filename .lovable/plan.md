
# äºˆç´„å¸Œæœ›æ—¥æ™‚ 3å€™è£œåˆ¶ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èªå‹ï¼‰å®Ÿè£…ãƒ—ãƒ©ãƒ³

## æ¦‚è¦

ç¾åœ¨ã®äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œ1ã¤ã®æ—¥æ™‚ã‚’é¸ã‚“ã§å³ç¢ºå®šã€ã™ã‚‹ä»•çµ„ã¿ã§ã™ãŒã€ã“ã‚Œã‚’**3ã¤ã®å¸Œæœ›æ—¥æ™‚ï¼ˆç¬¬ä¸€ã€œç¬¬ä¸‰å¸Œæœ›ï¼‰ã‚’é€ä¿¡ã—ã€äº‹æ¥­è€…ãŒã„ãšã‚Œã‹ã‚’æ‰¿èªã™ã‚‹**ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‹ã«å¤‰æ›´ã—ã¾ã™ã€‚

---

## ç¾çŠ¶ã®ä»•çµ„ã¿

```text
ã€ç¾åœ¨ã®ãƒ•ãƒ­ãƒ¼ã€‘
é¡§å®¢: æ—¥æ™‚ã‚’1ã¤é¸æŠ â†’ äºˆç´„é€ä¿¡ â†’ status='pending'
äº‹æ¥­è€…: äºˆç´„ã‚’ç¢ºèª â†’ æ‰¿èª/å´ä¸‹ â†’ status='confirmed'/'cancelled'
```

---

## æ–°ã—ã„ä»•çµ„ã¿

```text
ã€æ–°ãƒ•ãƒ­ãƒ¼ã€‘
é¡§å®¢: ç¬¬1ã€œç¬¬3å¸Œæœ›ã‚’é¸æŠ â†’ äºˆç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ â†’ status='pending'
       â”œâ”€â”€ preference1_date: 2025-02-01, preference1_time: "10:00"
       â”œâ”€â”€ preference2_date: 2025-02-02, preference2_time: "14:00"
       â””â”€â”€ preference3_date: 2025-02-03, preference3_time: "09:00"

äº‹æ¥­è€…: ãƒªã‚¯ã‚¨ã‚¹ãƒˆç¢ºèª â†’ å¸Œæœ›ã®ã„ãšã‚Œã‹ã‚’é¸æŠã—ã¦æ‰¿èª
       â†’ é¸æŠã—ãŸæ—¥æ™‚ãŒ selected_date/selected_time ã«ç¢ºå®š
       â†’ status='confirmed'
```

---

## å¤‰æ›´ç®‡æ‰€

| åŒºåˆ† | ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ†ãƒ¼ãƒ–ãƒ« | å¤‰æ›´å†…å®¹ |
|------|------------------|----------|
| DB | `bookings` ãƒ†ãƒ¼ãƒ–ãƒ« | 6ã¤ã®æ–°ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆ3ã¤ã®å¸Œæœ›æ—¥æ™‚ Ã— æ—¥ä»˜ãƒ»æ™‚é–“ï¼‰ |
| DB | `bookings` ãƒ†ãƒ¼ãƒ–ãƒ« | `approved_preference` ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆæ‰¿èªã—ãŸå¸Œæœ›ç•ªå·ï¼‰ |
| å‹å®šç¾© | `src/types/booking.ts` | `Booking` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¸Œæœ›æ—¥æ™‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ  |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | `BookingDateTimeSelection.tsx` | 3ã¤ã®æ—¥æ™‚ã‚’é¸æŠã§ãã‚‹UIã«å¤‰æ›´ |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | `BookingPage.tsx` | é¸æŠçŠ¶æ…‹ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–° |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | `useBooking.ts` | 3ã¤ã®å¸Œæœ›æ—¥æ™‚ã‚’ä¿å­˜ãƒ»é€ä¿¡ã™ã‚‹å‡¦ç† |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | `BookingDetailModal.tsx` | 3ã¤ã®å¸Œæœ›ã‚’è¡¨ç¤ºã—ã€æ‰¿èªæ™‚ã«é¸æŠã§ãã‚‹UI |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | `BookingSummary` (ç¢ºèªç”»é¢) | 3ã¤ã®å¸Œæœ›æ—¥æ™‚ã‚’è¡¨ç¤º |
| ãƒãƒƒãƒ‘ãƒ¼ | `bookingMapper.ts` | æ–°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒãƒƒãƒ”ãƒ³ã‚°è¿½åŠ  |

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´

### æ–°è¦ã‚«ãƒ©ãƒ ï¼ˆ`bookings` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

```sql
-- ç¬¬ä¸€å¸Œæœ›
preference1_date DATE,
preference1_time TEXT,

-- ç¬¬äºŒå¸Œæœ›
preference2_date DATE,
preference2_time TEXT,

-- ç¬¬ä¸‰å¸Œæœ›
preference3_date DATE,
preference3_time TEXT,

-- æ‰¿èªã•ã‚ŒãŸå¸Œæœ›ç•ªå·ï¼ˆ1, 2, or 3ï¼‰
approved_preference INTEGER
```

### æ‰¿èªæ™‚ã®å‹•ä½œ

äº‹æ¥­è€…ãŒã€Œç¬¬2å¸Œæœ›ã§æ‰¿èªã€ã‚’é¸æŠã—ãŸå ´åˆ:
1. `approved_preference = 2`
2. `selected_date = preference2_date`
3. `selected_time = preference2_time`
4. `status = 'confirmed'`

---

## UIè¨­è¨ˆ

### é¡§å®¢å´ï¼šæ—¥æ™‚é¸æŠç”»é¢

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… å¸Œæœ›æ—¥æ™‚ã‚’é¸æŠï¼ˆ3ã¤ã¾ã§ï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ã€ç¬¬1å¸Œæœ›ã€‘ â­ å¿…é ˆ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“… 2025å¹´2æœˆ1æ—¥(åœŸ)  ğŸ• 10:00              â”‚   â”‚
â”‚  â”‚                                 [âœ• å‰Šé™¤]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  ã€ç¬¬2å¸Œæœ›ã€‘ ä»»æ„                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“… 2025å¹´2æœˆ2æ—¥(æ—¥)  ğŸ• 14:00              â”‚   â”‚
â”‚  â”‚                                 [âœ• å‰Šé™¤]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  ã€ç¬¬3å¸Œæœ›ã€‘ ä»»æ„                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  â„¹ï¸ è¤‡æ•°ã®å€™è£œã‚’ç™»éŒ²ã™ã‚‹ã¨ã€äºˆç´„ãŒå–ã‚Šã‚„ã™ããªã‚Šã¾ã™ â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº‹æ¥­è€…å´ï¼šäºˆç´„è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“… å¸Œæœ›æ—¥æ™‚                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â—¯ ã€ç¬¬1å¸Œæœ›ã€‘ 2025å¹´2æœˆ1æ—¥(åœŸ) 10:00             â”‚
â”‚      [ã“ã®æ—¥æ™‚ã§æ‰¿èª]                               â”‚
â”‚                                                     â”‚
â”‚  â—¯ ã€ç¬¬2å¸Œæœ›ã€‘ 2025å¹´2æœˆ2æ—¥(æ—¥) 14:00             â”‚
â”‚      [ã“ã®æ—¥æ™‚ã§æ‰¿èª]                               â”‚
â”‚                                                     â”‚
â”‚  â—¯ ã€ç¬¬3å¸Œæœ›ã€‘ 2025å¹´2æœˆ3æ—¥(æœˆ) 09:00             â”‚
â”‚      [ã“ã®æ—¥æ™‚ã§æ‰¿èª]                               â”‚
â”‚                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  [äºˆç´„ã‚’å´ä¸‹ã™ã‚‹]                                   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“çš„è©³ç´°

### 1. å‹å®šç¾©ã®å¤‰æ›´ï¼ˆ`src/types/booking.ts`ï¼‰

```typescript
export interface Booking {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  
  // å¸Œæœ›æ—¥æ™‚ï¼ˆ3ã¤ï¼‰
  preference1Date?: string;
  preference1Time?: string;
  preference2Date?: string;
  preference2Time?: string;
  preference3Date?: string;
  preference3Time?: string;
  
  // æ‰¿èªã•ã‚ŒãŸå¸Œæœ›ç•ªå·
  approvedPreference?: number;
}
```

### 2. useBooking.ts ã®å¤‰æ›´

```typescript
// æ–°ã—ã„çŠ¶æ…‹
const [preferences, setPreferences] = useState<{
  date: Date | undefined;
  time: string | undefined;
}[]>([
  { date: undefined, time: undefined },
  { date: undefined, time: undefined },
  { date: undefined, time: undefined },
]);

// é€ä¿¡æ™‚ã«3ã¤ã®å¸Œæœ›æ—¥æ™‚ã‚’å«ã‚ã‚‹
const bookingData = {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  preference1_date: preferences[0].date ? format(...),
  preference1_time: preferences[0].time,
  preference2_date: preferences[1].date ? format(...),
  preference2_time: preferences[1].time,
  preference3_date: preferences[2].date ? format(...),
  preference3_time: preferences[2].time,
  // selected_date/time ã¯æ‰¿èªæ™‚ã«è¨­å®šã•ã‚Œã‚‹ãŸã‚ã€
  // åˆæœŸå€¤ã¨ã—ã¦ç¬¬1å¸Œæœ›ã‚’è¨­å®š
  selected_date: ...,
  selected_time: ...,
};
```

### 3. æ‰¿èªå‡¦ç†ã®å¤‰æ›´ï¼ˆ`BookingDetailModal.tsx`ï¼‰

```typescript
const handleApproveWithPreference = async (preferenceNumber: 1 | 2 | 3) => {
  const dateField = `preference${preferenceNumber}Date`;
  const timeField = `preference${preferenceNumber}Time`;
  
  const { error } = await supabase
    .from('bookings')
    .update({
      status: 'confirmed',
      approved_preference: preferenceNumber,
      selected_date: booking[dateField],
      selected_time: booking[timeField],
    })
    .eq('id', booking.id);
};
```

---

## äº’æ›æ€§ã¸ã®é…æ…®

- æ—¢å­˜ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ã¯ `selected_date`/`selected_time` ã‚’æŒã£ã¦ãŠã‚Šã€ãã®ã¾ã¾å‹•ä½œã—ã¾ã™
- æ–°è¦äºˆç´„ã®ã¿ãŒ `preference1_*` ã€œ `preference3_*` ã‚’ä½¿ç”¨ã—ã¾ã™
- ç®¡ç†ç”»é¢ã§ã¯ã€å¸Œæœ›æ—¥æ™‚ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯å¾“æ¥é€šã‚Š `selected_date`/`selected_time` ã‚’è¡¨ç¤º

---

## å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

1. **DB ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³** - æ–°è¦ã‚«ãƒ©ãƒ è¿½åŠ 
2. `src/types/booking.ts` - å‹å®šç¾©æ›´æ–°
3. `src/lib/bookingMapper.ts` - ãƒãƒƒãƒ”ãƒ³ã‚°æ›´æ–°
4. `src/hooks/useBooking.ts` - å¸Œæœ›æ—¥æ™‚çŠ¶æ…‹ç®¡ç†ãƒ»é€ä¿¡å‡¦ç†
5. `src/components/booking/BookingDateTimeSelection.tsx` - 3ã¤ã®æ—¥æ™‚é¸æŠUI
6. `src/pages/BookingPage.tsx` - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»çŠ¶æ…‹æ¥ç¶š
7. `src/components/BookingDetailModal.tsx` - å¸Œæœ›æ—¥æ™‚è¡¨ç¤ºãƒ»æ‰¿èªé¸æŠUI
8. `src/components/BookingConfirmationModal.tsx` - ç¢ºèªè¡¨ç¤ºæ›´æ–°
